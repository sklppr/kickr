// Generated by CoffeeScript 1.7.1
(function() {
  var socket, tables, template,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  socket = io();

  tables = $("#tables");

  template = Handlebars.compile($("#table-template").html());

  socket.on("id", function(id) {
    return socket.id = id;
  });

  socket.on("data", function(data) {
    var table, _i, _len, _ref, _results;
    tables.empty();
    _results = [];
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      table = data[_i];
      table.joined = (_ref = socket.id, __indexOf.call(table.player_ids, _ref) >= 0);
      table.full = table.fill_level === 100;
      table.ready = table.full && table.joined;
      table.joinable = !table.full && !table.joined;
      table.players = (function() {
        switch (table.player_count) {
          case 0:
            return "";
          case 1:
            return "1 player";
          default:
            return "" + table.player_count + " players";
        }
      })();
      _results.push(tables.append(template(table)));
    }
    return _results;
  });

  socket.on("ready", function() {
    return alert("Table is ready!");
  });

  tables.on("click", ".join-table", function(event) {
    return socket.emit("join", $(this).data("table"));
  });

  tables.on("click", ".leave-table", function(event) {
    return socket.emit("leave", $(this).data("table"));
  });

}).call(this);
