// Generated by CoffeeScript 1.7.1
(function() {
  var Notify, socket, tables, template,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  socket = io();

  Notify = {
    supported: function() {
      return window.hasOwnProperty("Notification");
    },
    permitted: function() {
      return Notification.permission === "granted";
    },
    request: function() {
      if (this.supported() && !this.permitted()) {
        return Notification.requestPermission();
      }
    },
    show: function(title, options) {
      if (!this.supported() && this.permitted()) {
        return new Notification(title, options);
      } else {
        return alert(options.body || title);
      }
    }
  };

  tables = $("#tables");

  template = Handlebars.compile($("#tables-template").html());

  socket.on("data", function(data) {
    var table, _i, _len, _ref;
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      table = data[_i];
      table.joined = (_ref = socket.io.engine.id, __indexOf.call(table.players, _ref) >= 0);
      table.joinable = !table.full && !table.joined;
      table.ready = table.full && table.joined;
      table.percentage = 100 * table.players.length / 4;
      table.players = (function() {
        switch (table.players.length) {
          case 0:
            return "";
          case 1:
            return "1 player";
          default:
            return "" + table.players.length + " players";
        }
      })();
    }
    return tables.html(template(data));
  });

  socket.on("ready", function(name) {
    return Notify.show("Kickr", {
      body: "Table " + name + " is ready!",
      icon: "/assets/notification-ready.png"
    });
  });

  tables.on("click", ".join-table", function(event) {
    socket.emit("join", $(this).data("table"));
    return Notify.request();
  });

  tables.on("click", ".leave-table", function(event) {
    return socket.emit("leave", $(this).data("table"));
  });

}).call(this);
